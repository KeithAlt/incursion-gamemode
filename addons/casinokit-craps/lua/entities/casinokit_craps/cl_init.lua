include("shared.lua")local a=false;CasinoKit.fetchFromWorkshop(664880145,function()a=true end)local b=CasinoKit.L;function ENT:Draw()self:DrawModel()end;function ENT:Initialize()self.RollData={d1offset=0,d2offset=0,d1_=6,d2_=6,d1=6,d2=6}end;function ENT:Think()if not self.Game or self.Game.class.name~=self:GetClGameClass()then local c=CasinoKit.classes[self:GetClGameClass()]if c then self.Game=c()self.Game:setTableEntity(self)for d,e in pairs(self._messageQueue or{})do self.Game:handleGameMessage(e.id,e.buf)end;self._messageQueue=nil end end end;function ENT:SendBet(f)if not self.localBet or self.localBet<=0 then LocalPlayer():ChatPrint(b"craps_setbet")return end;if self:GetRolling()then LocalPlayer():ChatPrint(b"craps_betrolling")return end;net.Start("ckit_craps_bet")net.WriteEntity(self)net.WriteString(f)net.WriteUInt(self.localBet,16)net.SendToServer()end;net.Receive("ckit_craps_bet",function()local g=net.ReadEntity()local h=net.ReadString()local i=net.ReadUInt(16)if not g or not g:IsValid()then return end;local j=table.Random{"chipsStack1.ogg","chipsStack3.ogg","chipsStack4.ogg","chipsStack5.ogg","chipsStack6.ogg"}g.Game:playTableSound("file:sound/casinokit/"..j)g.ExistingBets=g.ExistingBets or{}g.ExistingBets[h]=g.ExistingBets[h]or{}table.insert(g.ExistingBets[h],{amount=i})end)net.Receive("ckit_craps_rolldata",function()local g=net.ReadEntity()local k=net.ReadUInt(8)local l=net.ReadUInt(8)local m=net.ReadUInt(8)if not g or not g:IsValid()then return end;g.RollData=g.RollData or{}math.randomseed(m)g.RollData.d1offset=math.random(0,5)/50;g.RollData.d2offset=math.random(0,5)/50;g.RollData.d1_=g.RollData.d1 or 1;g.RollData.d2_=g.RollData.d2 or 1;g.RollData.d1=k;g.RollData.d2=l;timer.Simple(0.8,function()local n=table.Random{"diceThrow3.ogg","diceThrow3.ogg","diceThrow4.ogg"}g.Game:playTableSound("file:sound/casinokit/"..n)end)end)net.Receive("ckit_craps_updatebets",function()local g=net.ReadEntity()local o=net.ReadTable()if g.ExistingBets and#g.ExistingBets>0 then local j=table.Random{"chipsHandle1.ogg","chipsHandle3.ogg","chipsHandle4.ogg","chipsHandle5.ogg","chipsHandle6.ogg"}g.Game:playTableSound("file:sound/casinokit/"..j)end;g.ExistingBets={}for d,p in pairs(o)do g.ExistingBets[p.id]=g.ExistingBets[p.id]or{}table.insert(g.ExistingBets[p.id],{amount=p.amount})end end)local q=Vector(-22,0,34.5)local r=Angle(90,180,0)local s=0.081;function ENT:DrawTDUIChip(i,t,u,v)local w=q+Vector(u*s,t*s,(v or 0)*0.135)return CasinoKit.drawChipSingleStack(i,self:LocalToWorld(w),Angle(0,0,0))end;function ENT:DrawTDUIBets(h,t,u)local x=self.ExistingBets and self.ExistingBets[h]if not x then return end;local da=0;for d,y in pairs(x)do da=da+self:DrawTDUIChip(y.amount,t,u,da)end end;local o={{id="pass_",x=-260,y=25,w=45,h=270},{id="pass",x=-200,y=285,w=492,h=35},{id="dontpass_",x=-205,y=25,w=45,h=200},{id="dontpass",x=-150,y=255,w=442,h=20},{id="dontcome",x=-158,y=25,w=67,h=110},{id="come",x=-158,y=135,w=450,h=63},{id="field",x=-150,y=200,w=445,h=52},{id="seven",x=417,y=115,w=267,h=22},{id="craps",x=400,y=340,w=298,h=33},{id="h6",x=400,y=140,w=147,h=47},{id="h8",x=400,y=190,w=147,h=47},{id="h10",x=550,y=140,w=147,h=47},{id="h4",x=550,y=190,w=147,h=47},{id="3",x=400,y=240,w=100,h=45},{id="2",x=500,y=240,w=100,h=45},{id="12",x=600,y=240,w=100,h=45},{id="11",x=400,y=288,w=147,h=49},{id="11_",x=549,y=288,w=148,h=49},{id="ec",x=320,y=155,w=75,h=235}}for z,p in pairs({4,5,6,8,9,10})do local A={id="place"..p,x=-87+77*(z-1),y=66,w=75,h=55}table.insert(o,A)A={id="buy"..p,x=-87+77*(z-1),y=25,w=75,h=25}table.insert(o,A)end;local B=math.pow(126,2)local C={{pos=Vector(18,-6,34.5),ang=Angle(90,180,0)},{pos=Vector(-2,-50,40.5),ang=Angle(90,90,0)},{pos=Vector(2,50,40.5),ang=Angle(90,-90,0)}}local function D(k,l)if not k or not l then return"-"end;if l>k then local E=k;k=l;l=E end;return b("craps_d"..tonumber(k..l)).." ("..k..", "..l..")"end;local function F(t,u,G,H)local I={}table.insert(I,{x=t,y=u,u=0.5,v=0.5})for J=0,H do local K=math.rad(J/H*-361)table.insert(I,{x=t+math.sin(K)*G,y=u+math.cos(K)*G,u=math.sin(K)/2+0.5,v=math.cos(K)/2+0.5})end;local K=math.rad(0)table.insert(I,{x=t+math.sin(K)*G,y=u+math.cos(K)*G,u=math.sin(K)/2+0.5,v=math.cos(K)/2+0.5})return I end;local L={[1]=Angle(0,0,180),[2]=Angle(90,0,0),[3]=Angle(0,0,90),[4]=Angle(0,0,270),[5]=Angle(270,0,0),[6]=Angle(0,0,0)}local function M(N,O,P)if not O then O=Vector(0,0,0)end;local w=Vector(0,42,36)local Q=L[P]if N<0.95 then Q=Q+Angle(0,0,(N+0.05)*2*360)else Q=L[P]end;if N<1/2 then local R=N*2;w=Vector(0,(R*2-1)*45,-20*math.pow(R,2)+15*R+41)elseif N>1/2 and N<0.55 then local R=(N-0.5)/(0.55-0.5)w=Vector(0,R*2+45,-5*math.pow(R,2)+10*R+36)elseif N>0.55 and N<0.8 then local R=(N-0.55)/(0.8-0.55)w=Vector(0,-(R*5)+47,-20*math.pow(R,2)+15*R+41)end;return w+O,Q end;local S=CasinoKit.tdui;function ENT:DrawTranslucent()local T=self.Game and self.Game:getGameFriendlyName()or"Craps"local U=self.Game and self.Game:getGameFriendlySubtext()or"lmao negus"local Q=LocalPlayer():EyeAngles()Q:RotateAroundAxis(Q:Right(),90)Q:RotateAroundAxis(Q:Up(),-90)cam.Start3D2D(self:GetPos()+self:GetUp()*100,Q,0.2)surface.SetTextColor(255,255,255)cam.End3D2D()if LocalPlayer():EyePos():DistToSqr(self:GetPos())>B then return end;self:DrawModel()self.p=self.p or S.Create()local V=self.p;local W,X=-240,100;for d,p in pairs(o)do local Y,d,Z=V:TestAreaInput(W+p.x,X+p.y,p.w,p.h)if Y then self:SendBet(p.id)end;local _,a0=W+p.x+p.w/2,X+p.y+p.h/2;self:DrawTDUIBets(p.id,_,a0)if Z then self:DrawTDUIChip(self.localBet or 1,_,a0,da)end end;do local a1=(self:GetRollInterval()-self:GetTimeToNextRoll())/1.3;if not self:GetRolling()then a1=1+self.RollData.d1offset end;local w,Q=M(a1-self.RollData.d1offset,Vector(0,0,0),self.RollData.d1)CasinoKit.drawDie(self:LocalToWorld(w),self:LocalToWorldAngles(Q))if not self:GetRolling()then a1=1+self.RollData.d2offset end;w,Q=M(a1-self.RollData.d2offset,Vector(-5,0,0),self.RollData.d2)CasinoKit.drawDie(self:LocalToWorld(w),self:LocalToWorldAngles(Q))end;local a2="-"V:Text(b("craps_roll")..":","Trebuchet24",-240,70,nil,TEXT_ALIGN_LEFT)if self.RollData then local a3=255;if self:GetRolling()then a2=D(self.RollData.d1_,self.RollData.d2_)a3=150 else a2=D(self.RollData.d1,self.RollData.d2)end;V:Text(a2,"Trebuchet24",-190,70,Color(255,255,255,a3),TEXT_ALIGN_LEFT)end;if not self:GetRolling()then V:Text(b("craps_nextroll",{amount=math.floor(self:GetTimeToNextRoll())}),"Trebuchet24",10,70,nil,TEXT_ALIGN_LEFT)end;if self:GetPointRound()then draw.NoTexture()V:Polygon(F(180,85,27,50),Color(0,0,0),nil)V:Polygon(F(180,85,25,50),Color(255,255,255),nil)V:Text("ON","Trebuchet24",180,85,Color(0,0,0,255),TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)else draw.NoTexture()V:Polygon(F(180,85,27,50),Color(255,255,255),nil)V:Polygon(F(180,85,25,50),Color(0,0,0),nil)V:Text("OFF","Trebuchet24",180,85,Color(255,255,255),TEXT_ALIGN_CENTER,TEXT_ALIGN_CENTER)end;V:Text(b("craps_minbet",{amount=self:GetMinBet()}),"Trebuchet24",-240,435,nil,TEXT_ALIGN_LEFT)V:Cursor()V:Render(self:LocalToWorld(q),self:LocalToWorldAngles(r),s)self.betp=self.betp or S.Create()local a4=self.betp;local a5=input.IsShiftDown()and(input.IsKeyDown(KEY_LALT)and 100 or 10)or 1;if a4:Button("<","!Roboto@20",0,0,30,30)then self.localBet=math.max((self.localBet or 0)-a5,self:GetMinBet())end;a4:Rect(35,0,70,30)a4:Text(self.localBet or 0,"!Roboto@22",70,4,Color(255,255,255))if a4:Button(">","!Roboto@20",110,0,30,30)then self.localBet=math.max((self.localBet or 0)+a5,self:GetMinBet())end;a4:Cursor()local a6=self:WorldToLocal(LocalPlayer():EyePos())local a7,a8=nil,math.huge;for d,a9 in pairs(C)do local aa=a6:Distance(a9.pos)if aa<a8 then a7=a9;a8=aa end end;CasinoKit.drawChipStack(LocalPlayer():CKit_GetChips()or 0,self:LocalToWorld(a7.pos+a7.ang:Right()*-4+a7.ang:Up()*-1),self:LocalToWorldAngles(a7.ang),true)a4:Render(self:LocalToWorld(a7.pos),self:LocalToWorldAngles(a7.ang),0.1)end