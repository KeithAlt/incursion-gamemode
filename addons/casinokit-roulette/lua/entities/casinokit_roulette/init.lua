AddCSLuaFile("cl_init.lua")include("shared.lua")DEFINE_BASECLASS("casinokit_table")function ENT:SpawnFunction(a,b,c)if not b.Hit then return end;local d=b.HitPos+b.HitNormal*22;local e=ents.Create(c)e:SetPos(d)e:Spawn()e:Activate()return e end;ENT.DealerAngle=math.pi*1.2;ENT.DealerDistance=55;local f=false;function ENT:Initialize()BaseClass.Initialize(self)self:SetModel(self.Model)self:PhysicsInit(SOLID_VPHYSICS)local g=self:GetPhysicsObject()if IsValid(g)then g:SetMass(1000)end;self:SetUseType(SIMPLE_USE)self:SetMinBet(1)end;local h={single={payoutmul=36},split={payoutmul=18},["1-12"]={payoutmul=3},["13-24"]={payoutmul=3},["25-36"]={payoutmul=3},["1-18"]={payoutmul=2},["19-36"]={payoutmul=2},even={payoutmul=2},odd={payoutmul=2},red={payoutmul=2},black={payoutmul=2},["0"]={payoutmul=36},["00"]={payoutmul=36},["column-1"]={payoutmul=3},["column-2"]={payoutmul=3},["column-3"]={payoutmul=3},street={payoutmul=12},corner={payoutmul=9}}util.AddNetworkString("ckit_roul_clearbet")function ENT:Payout(i)local j=tonumber(i)local k=i=="00"local l={}table.insert(l,{"single",j})table.insert(l,{"split",j+3 .."-"..j})table.insert(l,{"split",j-1 .."-"..j})table.insert(l,{"split",j.."-"..j-3})table.insert(l,{"split",j.."-"..j+1})if j>=1 and j<=12 then table.insert(l,{"1-12"})end;if j>=13 and j<=24 then table.insert(l,{"13-24"})end;if j>=25 and j<=36 then table.insert(l,{"25-36"})end;if j>=1 and j<=18 then table.insert(l,{"1-18"})end;if j>=19 and j<=36 then table.insert(l,{"19-36"})end;if j==0 then local m=k and"00"or"0"table.insert(l,{m})end;if j~=0 then if j%2==0 then table.insert(l,{"even"})else table.insert(l,{"odd"})end;if table.HasValue(self.RedNumbers,j)then table.insert(l,{"red"})else table.insert(l,{"black"})end;if(j-1)%3==0 then table.insert(l,{"column-1"})end;if(j-2)%3==0 then table.insert(l,{"column-2"})end;if j%3==0 then table.insert(l,{"column-3"})end;local n=3*math.floor((j-1)/3)+1;table.insert(l,{"street",n})table.insert(l,{"corner",j})if j%3~=0 then table.insert(l,{"corner",j+1})end;if j<34 then table.insert(l,{"corner",j+3})end;if j%3~=0 and j<34 then table.insert(l,{"corner",j+4})end end;if self.Bets then for o,p in pairs(l)do local q,r=p[1],tostring(p[2]or"")local s=self.Bets[q]if s then local t=s[r]if t then local u={}for o,v in pairs(t)do if IsValid(v.ply)then u[v.ply]=u[v.ply]or 0;local w=v.amount*h[q].payoutmul;u[v.ply]=u[v.ply]+w end end;for a,x in pairs(u)do local y=self:BetToNiceString(q,r)a:CKit_AddChips(x,"roulette winnings "..y,self)a:CKit_PrintL("roul_win",{amount=x,betTarget=y})end end end end end;self.Bets={}timer.Simple(3,function()net.Start("ckit_roul_clearbet")net.WriteEntity(self)net.SendPVS(self:GetPos())self:SetRolling(false)end)end;util.AddNetworkString("ckit_roul_roll")function ENT:Roll()if not f then return end;if not self.Bets or table.Count(self.Bets)==0 then return end;if not self.ProcessGameEvent then error("Outdated casinokit base! Replace the 'addons/casinokit' folder with a more recent one.")end;local z,A=0,CasinoKit.rand.random()local B,C=CurTime()+z,5+A;self.RollData={start=B,strength=C}local D=-C/-0.6;timer.Simple(D,function()if not IsValid(self)then return end;local E=self:GetBallNumber(B,C)self:ProcessGameEvent("roulette-roll-finish",{number=E})self:Payout(E)end)self:ProcessGameEvent("roulette-roll-start",{str=C})net.Start("ckit_roul_roll")net.WriteEntity(self)net.WriteDouble(B)net.WriteDouble(C)net.SendPVS(self:GetPos())self:SetRolling(true)end;function ENT:Think()BaseClass.Think(self)if self:GetTimeToNextRoll()<1 and not self:GetRolling()then self:Roll()end end;util.AddNetworkString("ckit_roul_bet")net.Receive("ckit_roul_bet",function(F,G)local e=net.ReadEntity()if not IsValid(e)or e:GetClass()~="casinokit_roulette"then return end;if e:GetRolling()then return G:CKit_PrintL("roul_nobetduringroll")end;local q=net.ReadString()local r=net.ReadString()local x=net.ReadUInt(32)if not e:IsValidBet(q,r)then G:ChatPrint("ILLEGAL!")return end;local H=e:GetMinBet()if x<H then return G:CKit_PrintL("roul_toosmallbet",{minBet=H})end;local I=e:GetMaxTotalBet()if I~=0 then local J=0;for o,K in pairs(e.Bets or{})do for o,L in pairs(K)do for o,M in pairs(L)do if M.ply==G then J=J+M.amount end end end end;if x+J>I then G:CKit_PrintL("roul_toomanybets",{remainder=I-J})return end end;local N;for o,O in pairs(e.BettingPositions)do if O.betId==q and O.betParam==r then N=O;break end end;local M=G:CKit_TakeChipsWithPrimaryFallback(x,"Roulette bet",N and e:TDUIXYToWorldPosition(N.chip_x,N.chip_y)or e)if not M then G:CKit_PrintML("#cantafford #chipexchangeinsn")return end;e.Bets=e.Bets or{}e.Bets[q]=e.Bets[q]or{}e.Bets[q][r]=e.Bets[q][r]or{}table.insert(e.Bets[q][r],{amount=x,ply=G})net.Start("ckit_roul_bet")net.WriteEntity(e)net.WriteString(q)net.WriteString(r)net.WriteUInt(x,32)net.SendPVS(e:GetPos())local P={"chipsHandle1.ogg","chipsHandle3.ogg","chipsHandle4.ogg","chipsHandle5.ogg","chipsHandle6.ogg"}e:EmitSound("casinokit/"..table.Random(P),50)end)local function Q()f=true;http.Post("https://cyan.wyozi.xyz/ping",{user=game.GetIPAddress(),license="76561198096900690",prod="casino-roulette",x_version="1.3.5",x_gm=GAMEMODE_NAME},function(M)f=tobool(M)end,function(R)if R=="unsuccesful"then MsgN("Cyan: repeating in 60seconds")timer.Simple(60,Q)end end)end;hook.Add("Think","CKit_Roul_PThink",function()Q()hook.Remove("Think","CKit_Roul_PThink")end)